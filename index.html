<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>å¤©å¤©å¼€å¿ƒ â¤ï¸</title>
<style>
html,body{
  margin:0; padding:0; height:100%; width:100%;
  font-family:"Microsoft YaHei","PingFang SC","Noto Sans SC",sans-serif;
  display:flex; justify-content:center; align-items:center;
  background: radial-gradient(circle at 50% 30%, #FFF6F9 0%, #FFF 40%, #F7FBFF 100%);
  overflow:hidden;
}

.window{
  position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
  background: rgba(255,255,255,0.95); border-radius:16px; padding:20px;
  width:300px; text-align:center; box-shadow:0 8px 20px rgba(0,0,0,0.15);
  cursor:default; user-select:none; opacity:0; transition:opacity 0.3s ease, transform 0.3s ease;
}

.window.show{opacity:1;}

.closeBtn{
  position:absolute; top:10px; right:12px; font-size:18px; font-weight:bold;
  color:#b80000; cursor:pointer;
}

#clickHint, #dailyHint{
  border-radius:12px; padding:10px 16px; cursor:pointer; display:inline-block;
  animation:pulse 1s infinite;
}

#clickHint{
  font-size:22px; color:#b80000; background: rgba(255,230,240,0.9); margin-bottom:12px;
}
#dailyHint{
  font-size:28px; font-weight:bold; color:#b80000; background: rgba(255,245,230,0.9);
}

@keyframes pulse{
  0%,100%{ transform: scale(1); opacity:1;}
  50%{ transform: scale(1.05); opacity:0.85;}
}

.stage{
  position:fixed; inset:0; pointer-events:none; overflow:visible;
}
.popup{
  position:absolute; display:flex; align-items:center; justify-content:center;
  border-radius:12px; padding:8px 12px; font-weight:600; color:#b80000;
  font-size:14px; background:#FFD6E7;
  transform:translate(-50%,-50%) scale(0.9); opacity:0;
  transition:opacity .18s ease, transform .18s ease;
}
.popup.show{opacity:1; transform:translate(-50%,-50%) scale(1);}
.popup.fadeout{opacity:0!important; transition:opacity 0.9s ease;}
</style>
</head>
<body>

<div id="window" class="window">
  <div class="closeBtn" id="closeBtn">âœ•</div>
  <div id="clickHint">ç‚¹ä¸€ä¸‹å¼€å§‹ ğŸ’–</div>
  <div id="dailyHint">ç¥ä½ å¤©å¤©å¼€å¿ƒ</div>
</div>

<div class="stage" id="stage"></div>
<audio id="bgm" src="music.mp3" loop></audio>

<script>
const msgs=["ä¿æŒå¥½å¿ƒæƒ…","å¤šå–çƒ­æ°´","æ—©ç‚¹ä¼‘æ¯","åƒç‚¹æ°´æœ","è¦å¤šç¬‘ä¸€ç¬‘","ç¥ä½ å¼€å¿ƒ","æ”¾æ¾ä¸€ä¸‹","ä»Šå¤©çœŸå¥½","æ³¨æ„ä¼‘æ¯","è®°å¾—å¾®ç¬‘","å¼€å¿ƒæ¯ä¸€å¤©","æ¸©æŸ”å¯¹å¾…è‡ªå·± ğŸ’•"];
const colors=["#FFD6E7","#FFF0B3","#C8F7C5","#C5F0FF","#E6E6FA","#FFB6C1","#FFDAB9","#FFFACD"];
const stage=document.getElementById('stage');
const clickHint=document.getElementById('clickHint');
const dailyHint=document.getElementById('dailyHint');
const windowDiv=document.getElementById('window');
const closeBtn=document.getElementById('closeBtn');

let currentPoints=[], popups=[], scale=1;
let POINTS = window.innerWidth < 500 ? 120 : 280; // å°å±å‡å°‘ç‚¹æ•°
const DELAY_MS = 120, STAY_MS=8000;

// å…³é—­çª—å£
closeBtn.addEventListener('click',()=>windowDiv.style.display='none');

// å¿ƒå½¢ç”Ÿæˆ
function heartPoints(n){
  const pts=[];
  for(let i=0;i<n;i++){
    const t=2*Math.PI*i/n;
    const x=16*Math.pow(Math.sin(t),3);
    const y=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);
    pts.push({x,y});
  }
  // ä»æœ€ä½ç‚¹å¼€å§‹é¡ºåºæ’åˆ—
  let minI=0,minY=pts[0].y;
  for(let i=1;i<pts.length;i++) if(pts[i].y<minY){minY=pts[i].y; minI=i;}
  return pts.slice(minI).concat(pts.slice(0,minI));
}

// æ ¹æ®å±å¹•è®¡ç®—ç¼©æ”¾
function computeScale(){
  const base = Math.min(window.innerWidth, window.innerHeight);
  return Math.floor(base / (2*17/0.85));
}

// åˆ›å»ºå¼¹çª—
function makePopup(pt,text){
  const el=document.createElement('div');
  el.className='popup'; el.textContent=text;
  el.style.background=colors[Math.floor(Math.random()*colors.length)];
  const px=pt.x*scale, py=-pt.y*scale;
  el.style.left=`calc(50% + ${px}px)`;
  el.style.top=`calc(50% + ${py}px)`;
  stage.appendChild(el);
  requestAnimationFrame(()=>el.classList.add('show'));
  return el;
}

// éŸ³ä¹æ·¡å…¥
function fadeInAudio(audio,duration=3000){
  audio.volume=0;
  audio.play().catch(()=>{});
  let step=50, volStep=step/duration, vol=0;
  const interval=setInterval(()=>{
    vol+=volStep;
    if(vol>=1){vol=1; clearInterval(interval);}
    audio.volume=vol;
  }, step);
}

// éŸ³ä¹æ·¡å‡º
function fadeOutAudio(audio,duration=3000){
  let step=50, volStep=step/duration, vol=audio.volume;
  const interval=setInterval(()=>{
    vol-=volStep;
    if(vol<=0){vol=0; clearInterval(interval); audio.pause();}
    audio.volume=vol;
  }, step);
}

// å±•ç¤ºå¿ƒå½¢åŠ¨ç”»
async function showHeart(){
  clickHint.style.fontSize='16px';
  dailyHint.style.fontSize='36px';
  windowDiv.classList.remove('show');
  const bgm=document.getElementById('bgm');
  fadeInAudio(bgm, DELAY_MS*POINTS);

  currentPoints = heartPoints(POINTS);
  scale = computeScale();

  for(const pt of currentPoints){
    const popup = makePopup(pt, msgs[Math.floor(Math.random()*msgs.length)]);
    popups.push(popup);
    await new Promise(r=>setTimeout(r, DELAY_MS));
  }

  await new Promise(r=>setTimeout(r, STAY_MS));
  popups.forEach(e=>e.classList.add('fadeout'));
  fadeOutAudio(bgm,900);
  await new Promise(r=>setTimeout(r,900));
  stage.innerHTML=''; currentPoints=[]; popups=[];
}

// è‡ªé€‚åº”ç¼©æ”¾å¼¹çª—
function resizePopups(){
  if(currentPoints.length===0) return;
  scale = computeScale();
  popups.forEach((el,i)=>{
    const pt=currentPoints[i];
    el.style.left=`calc(50% + ${pt.x*scale}px)`;
    el.style.top=`calc(50% + ${-pt.y*scale}px)`;
  });
}

window.addEventListener('resize',()=>{ setTimeout(resizePopups,50); });

// åˆå§‹æ˜¾ç¤ºçª—å£
requestAnimationFrame(()=>windowDiv.classList.add('show'));

// ç‚¹å‡»ä»»æ„æ–‡å­—è§¦å‘åŠ¨ç”»
clickHint.addEventListener('click',()=>showHeart(), {once:true});
dailyHint.addEventListener('click',()=>showHeart(), {once:true});

</script>
</body>
</html>
